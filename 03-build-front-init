#!/command/with-contenv bash
export VITE_URL_PREFIX=$NB_PREFIX

source /home/jovyan/.fend

if [ "$BUILD_FRONTEND" = "false" ]
then
    echo "INFO: building webapp frontend..."
    cd /home/jovyan/open-webui-vite/backend
    pip install -r requirements.txt
    cd /home/jovyan/open-webui-vite
    npm install && npm audit fix
    npm run build
    # Update the flag to prevent rebuilding on subsequent starts
    sed -i 's/export BUILD_FRONTEND="false"/export BUILD_FRONTEND="true"/g' /home/jovyan/.fend
    echo "INFO: Frontend ready..."
else
    echo "INFO: Frontend ready..."
fi
